#!/bin/sh

# Substitute environment variables into the Nginx configuration template
# Read from default.conf.template and write to default.conf
envsubst '
${DOCKER_HOST_HTTP_PORT}
${DOCKER_HOST_HTTPS_PORT}
${WP_HTTP_PORT}
${WP_HTTPS_PORT}
${NGINX_SERVER_NAME}
${NGINX_SERVER_ALIAS}
${NGINX_ROOT_DIR}
${NGINX_INDEX}
${NGINX_LOG_FORMAT}
${NGINX_ACCESS_LOG}
${NGINX_ERROR_LOG}
${NGINX_CLIENT_MAX_BODY_SIZE}
${NGINX_CLIENT_BODY_BUFFER_SIZE}
${NGINX_CLIENT_HEADER_BUFFER_SIZE}
${NGINX_LARGE_CLIENT_HEADER_BUFFERS}
${NGINX_CLIENT_BODY_TIMEOUT}
${NGINX_CLIENT_HEADER_TIMEOUT}
${NGINX_KEEPALIVE_TIMEOUT}
${NGINX_SEND_TIMEOUT}
${NGINX_KEEPALIVE_REQUESTS}
${NGINX_PROXY_TIMEOUT}
${NGINX_SENDFILE}
${NGINX_TCP_NODELAY}
${NGINX_TCP_NOPUSH}
${NGINX_RESET_TIMEDOUT_CONNECTION}
${NGINX_SERVER_TOKENS}
${NGINX_UNDERSCORES_IN_HEADERS}
${NGINX_CHARSET}
${NGINX_CHARSET_TYPES}
${NGINX_WORKER_PROCESSES}
${NGINX_WORKER_CONNECTIONS}
${NGINX_WORKER_RLIMIT_NOFILE}
${NGINX_GZIP}
${NGINX_GZIP_HTTP_VERSION}
${NGINX_GZIP_COMP_LEVEL}
${NGINX_GZIP_MIN_LENGTH}
${NGINX_GZIP_PROXIED}
${NGINX_GZIP_TYPES}
${NGINX_GZIP_VARY}
${NGINX_GZIP_DISABLE}
${NGINX_TYPES_HASH_MAX_SIZE}
${NGINX_TYPES_HASH_BUCKET_SIZE}
${NGINX_PREFER_SERVER_CIPHERS}
${NGINX_HTTP2}
${NGINX_REWRITE}
${NGINX_HSTS}
${NGINX_X_FRAME_OPTIONS}
${NGINX_X_CONTENT_TYPE_OPTIONS}
${NGINX_X_XSS_PROTECTION}
${NGINX_REFERRER_POLICY}
${NGINX_CONTENT_SECURITY_POLICY}
${NGINX_STRICT_TRANSPORT_SECURITY}
${NGINX_REWRITE_LOG}
${NGINX_ENABLE_SSL}
${NGINX_SSL_CERT}
${NGINX_SSL_CERT_KEY}
${NGINX_SSL_TRUSTED_CERT}
${NGINX_SSL_DHPARAM}
${NGINX_SSL_CIPHERS}
${NGINX_SSL_PROTOCOLS}
${NGINX_SSL_SESSION_TICKET}
${NGINX_SSL_SESSION_CACHE}
${NGINX_SSL_SESSION_TIMEOUT}
${NGINX_SSL_STAPLING}
${NGINX_SSL_STAPLING_VERIFY}
${NGINX_SSL_VERIFY_DEPTH}
${NGINX_SSL_VERIFY_CLIENT}
${NGINX_RESOLVER}
${NGINX_RESOLVER_TIMEOUT}
${NGINX_RESOLVER_VALID}
${NGINX_PROXY_PASS}
${NGINX_PROXY_READ_TIMEOUT}
${NGINX_PROXY_CONNECT_TIMEOUT}
${NGINX_PROXY_SEND_TIMEOUT}
${NGINX_PROXY_BUFFER_SIZE}
${NGINX_PROXY_BUFFERS}
${NGINX_PROXY_BUSY_BUFFERS_SIZE}
${NGINX_PROXY_MAX_TEMP_FILE_SIZE}
${NGINX_PROXY_TEMP_FILE_SIZE}
${NGINX_PROXY_TEMP_FILE_WRITE_SIZE}
${NGINX_PROXY_TEMP_DIR}
' < /etc/conf/nginx/default.conf.template > /etc/nginx/conf.d/default.conf

# Execute the original Nginx entrypoint command
# This ensures that Nginx starts correctly after the templating.
exec nginx -g "daemon off;"